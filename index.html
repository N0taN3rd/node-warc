<html>
<head>
<script src="dist/nodewarc.js"></script>
<script>
function parseWARC(files) {
    let reader = new FileReader();

    reader.onloadend = function() {
        var inflator, strm, _in, len, pos = 0;

        var rstream = new stream.Readable();
        rstream._read = () => {};

        const data = reader.result;

        do {
            len = data.byteLength - pos;
            _in = new Uint8Array(data, pos, len);

            inflator = new pako.Inflate();
            strm = inflator.strm;
            inflator.push(_in, true);

            rstream.push(inflator.result);

            pos += strm.next_in;
        } while (strm.avail_in);

        rstream.push(null);

        // attempt to set large window to avoid error
        //var gunzip = rstream.pipe(zlib.createGunzip({chunkSize: 1024*1024*16, windowBits: 15, flush: zlib.Z_NO_FLUSH, finishFlush: zlib.Z_SYNC_FLUSH}));

        const parser = new WARCParser(rstream);
        parser.on('record', record => { console.log(record) })
        parser.on('done', () => { console.log('finished') })
        parser.on('error', error => { console.error(error) })
        parser.start()
    }

    reader.readAsArrayBuffer(files[0]);
}
</script>
</head>
<body>

        <span>
                Test WARC:
                <input id="file-input" type="file" name="file-input" onchange="parseWARC(this.files)" style="display: none;" />
                <input id="coll-name" type="text" value="replay" name="coll-name"/>
                <button onclick="document.getElementById('file-input').click();">Open WARC File</button>
        </span>
</body>
</html>
